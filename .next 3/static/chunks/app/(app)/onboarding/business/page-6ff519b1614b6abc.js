(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[352],{4382:(e,a,s)=>{Promise.resolve().then(s.bind(s,9909))},9909:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>n});var t=s(5155),r=s(2115);function l(){return crypto.randomUUID()}function n(){let[e,a]=(0,r.useState)(""),[s,n]=(0,r.useState)(()=>l()),[i,o]=(0,r.useState)([]),[d,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(null),[x,p]=(0,r.useState)(!1),[h,g]=(0,r.useState)(null);async function f(e){c(!0),g(null);try{let a="/api/places/details?placeId=".concat(encodeURIComponent(e),"&sessionToken=").concat(encodeURIComponent(s)),t=await fetch(a),r=await t.json();m(r),n(l()),o([])}catch(e){g(e instanceof Error?e.message:"Failed to fetch place details")}finally{c(!1)}}async function y(){if(u){p(!0),g(null);try{var e,a;let s=await fetch("/api/businesses/upsert",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u.displayName,google_place_id:u.id,google_maps_place_uri:u.googleMapsUri,google_maps_write_review_uri:u.writeAReviewUri,review_link:u.writeAReviewUri,google_rating:null!=(e=u.rating)?e:null,address:null!=(a=u.formattedAddress)?a:null})});if(!s.ok)throw Error(await s.text());window.location.href="/dashboard"}catch(e){g(e instanceof Error?e.message:"Save failed")}finally{p(!1)}}}(0,r.useEffect)(()=>{let a=new AbortController;if(!e.trim())return void o([]);c(!0);let t=setTimeout(async()=>{try{let t=await fetch("/api/places/autocomplete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:e,sessionToken:s}),signal:a.signal}),r=await t.json();o(r.items||[])}catch(e){g(e instanceof Error?e.message:"Autocomplete failed")}finally{c(!1)}},200);return()=>{a.abort(),clearTimeout(t)}},[e,s]);let b=null==u?void 0:u.writeAReviewUri,v=(0,r.useMemo)(()=>b?"/api/qr?data=".concat(encodeURIComponent(b),"&format=png&scale=8"):null,[b]),w=(0,r.useMemo)(()=>b?"/api/qr?data=".concat(encodeURIComponent(b),"&format=svg&scale=8"):null,[b]);return(0,t.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50 py-10",children:(0,t.jsxs)("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[(0,t.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900",children:"Connect your business"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Search your business by name, then confirm the address."}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{className:"w-full rounded-xl border border-gray-200 px-4 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Start typing your business name…",value:e,onChange:e=>a(e.target.value)}),d&&(0,t.jsx)("div",{className:"absolute right-3 top-3 text-sm text-gray-500",children:"Searching…"}),!!i.length&&(0,t.jsxs)("div",{className:"mt-2 rounded-xl border border-gray-200 bg-white shadow-md",children:[(0,t.jsx)("ul",{className:"max-h-72 overflow-auto",children:i.map(e=>(0,t.jsxs)("li",{className:"px-4 py-3 hover:bg-gray-50 cursor-pointer",onClick:()=>f(e.placeId),children:[(0,t.jsx)("div",{className:"font-medium",children:e.mainText}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:e.secondaryText})]},e.placeId))}),(0,t.jsx)("div",{className:"border-t px-3 py-2 text-xs text-gray-500 flex items-center gap-2",children:(0,t.jsx)("span",{children:"Powered by Google"})})]})]}),u&&(0,t.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm space-y-3",children:[(0,t.jsx)("div",{className:"text-lg font-semibold",children:u.displayName}),(0,t.jsx)("div",{className:"text-gray-700",children:u.formattedAddress}),(0,t.jsxs)("div",{className:"text-gray-700",children:[u.rating?"Rating ".concat(u.rating," \xb7 "):"",u.userRatingCount?"".concat(u.userRatingCount," reviews"):""]}),b&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{className:"w-full rounded-xl border border-gray-200 px-3 py-2 focus:outline-none",readOnly:!0,value:b}),(0,t.jsx)("button",{className:"rounded-xl px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-medium hover:from-blue-700 hover:to-purple-700 transition",onClick:()=>navigator.clipboard.writeText(b),children:"Copy"}),(0,t.jsx)("a",{className:"rounded-xl px-4 py-2 border border-gray-200 hover:bg-gray-50 transition",target:"_blank",href:b,rel:"noreferrer",children:"Test"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[v&&(0,t.jsx)("img",{src:v,alt:"QR code",className:"h-32 w-32 border rounded"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[v&&(0,t.jsx)("a",{className:"underline text-blue-600",href:v,download:!0,children:"Download QR (PNG)"}),w&&(0,t.jsx)("a",{className:"underline text-blue-600",href:w,download:!0,children:"Download QR (SVG)"})]})]})]}),(0,t.jsx)("div",{className:"pt-2",children:(0,t.jsx)("button",{disabled:x,className:"rounded-xl px-5 py-3 bg-gray-900 text-white hover:bg-gray-800 disabled:opacity-50 transition",onClick:y,children:x?"Saving…":"Save business"})})]}),h&&(0,t.jsx)("div",{className:"text-red-600 text-sm",children:h})]})})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=4382)),_N_E=e.O()}]);